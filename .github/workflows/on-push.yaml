name: on-push-and-dispatch

on:
  push:
  workflow_dispatch:
    inputs:
      ENV_VARIABLE:
      OTHER_ENV_VARIABLE:

env:
  IS_MASTER: ${{ github.ref_name == github.event.repository.default_branch }}
  IS_NOT_MASTER: ${{ github.ref_name != github.event.repository.default_branch }}

jobs:
  run-some-job:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Echo
        run: |
          echo '${{ toJSON(github) }}'
          echo ${{ github.ref_name }}
          echo ${{ github.event.repository.master_branch }}
          echo "[IS_MASTER] ${{ env.IS_MASTER }}"
          echo "[IS_NOT_MASTER] ${{ env.IS_NOT_MASTER }}"
          echo "[DIRECT_JOB] ${{ env.ENV_VARIABLE }}"
          echo "[DIRECT_JOB] ${{ env.OTHER_ENV_VARIABLE }}"
          echo "[DIRECT_JOB] ${{ secrets.SUPER_SECRET }}"
          echo '### Nice work *${{ github.actor }}*! :rocket:' >> $GITHUB_STEP_SUMMARY
          echo '' >> $GITHUB_STEP_SUMMARY
          echo 'You just executed ${{ github.workflow }}' >> $GITHUB_STEP_SUMMARY
          [[ $IS_MASTER = true ]] && isMaster="a **default** branch" || a="not a **default** branch"
          echo "on ${{ github.ref_name }} branch which is $isMaster" >> $GITHUB_STEP_SUMMARY
      - name: Adding markdown
        run: echo '### 2. Hello world! :rocket:' >> $GITHUB_STEP_SUMMARY

  run-template:
    uses: ./.github/workflows/template.yaml
    with:
      ENV_VARIABLE: ${{ inputs.ENV_VARIABLE || 'default-ENV_VARIABLE' }}
      OTHER_ENV_VARIABLE: ${{ inputs.OTHER_ENV_VARIABLE || 'default-OTHER_ENV_VARIABLE' }}
    secrets:
      ALL_SECRETS: '${{ toJSON(secrets) }}'

  run-template-inherited:
    uses: ./.github/workflows/template-with-inherited-secrets.yaml
    with:
      ENV_VARIABLE: ${{ inputs.ENV_VARIABLE || 'default-ENV_VARIABLE' }}
      OTHER_ENV_VARIABLE: ${{ inputs.OTHER_ENV_VARIABLE || 'default-OTHER_ENV_VARIABLE' }}
    secrets: inherit